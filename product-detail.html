<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ข้อมูลสุนัข - ซีซาร์ เคนเนล</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="shop-layout">
        <aside class="sidebar" id="sidebar">
            <div>
                <div class="sidebar-logo">Cesar Kennel<span></span></div>
                <nav class="sidebar-nav">
                    <h3>เมนู</h3>
                    <ul>
                        <li><a href="index.html">สุนัขทั้งหมด</a></li>
                        <li><a href="index.html?gender=ผู้">เพศผู้</a></li>
                        <li><a href="index.html?gender=เมีย">เพศเมีย</a></li>
                    </ul>
                </nav>

                <div class="sidebar-follow">
                    <h3>ช่องทางติดตาม</h3>
                    <ul class="sidebar-social-links" id="sidebar-social-links">
                        <!-- Links will be injected by script -->
                    </ul>
                </div>
            </div>
            <div class="sidebar-footer">
                &copy; 2568 ซีซาร์ เคนเนล
                <p><a href="login.html" id="auth-link">เข้าสู่ระบบผู้ดูแล</a></p>
            </div>
        </aside>
        
        <main class="main-content" id="main-content">
            <header class="mobile-header">
                <div class="mobile-logo">Cesar Kennel<span></span></div>
                <button class="mobile-menu-button" id="menu-toggle">☰</button>
            </header>

            <div class="product-detail-grid" id="product-detail-container">
                <!-- Loading message or dynamic content appears here -->
            </div>
        </main>
    </div>

    <footer class="site-footer">
        <div class="footer-grid">
            <div class="footer-info">
                <h3 class="footer-logo">ซีซาร์ เคนเนล</h3>
                <p class="footer-description">ฟาร์มสุนัขเกรดพรีเมียม จัดส่งทั่วประเทศ</p>
                <div class="footer-contact">
                    <span id="footer-phone"></span>
                    <span id="footer-email"></span>
                    <!-- MODIFICATION: Added address container -->
                    <div id="footer-address" style="white-space: pre-line; margin-top: 1em;"></div>
                </div>
                <div class="social-links">
                    <!-- Reordered Social Links -->
                    <a href="#" id="social-line" aria-label="Line" target="_blank" style="display: none;"><img src="icons/line.png" alt="Line"></a>
                    <a href="#" id="social-fb" aria-label="Facebook" target="_blank" style="display: none;"><img src="icons/messenger.png" alt="Facebook Messenger"></a>
                    <a href="#" id="social-tiktok" aria-label="TikTok" target="_blank" style="display: none;"><img src="icons/tik-tok.png" alt="TikTok"></a>
                    <a href="#" id="social-ig" aria-label="Instagram" target="_blank" style="display: none;"><img src="icons/instagram.png" alt="Instagram"></a>
                </div>
            </div>
            <div class="footer-map" id="footer-map-container">
                <!-- Google Map Iframe will be injected here by script -->
            </div>
        </div>
    </footer>


    <script src="script.js"></script>

    <script type="module">
        import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA85L7n2CGKocgWg-Z8TsNlUN9AVVJguBQ",
            authDomain: "cesarkennel.firebaseapp.com",
            projectId: "cesarkennel",
            storageBucket: "cesarkennel.firebasestorage.app",
            messagingSenderId: "512752480416",
            appId: "1:512752480416:web:c71aa9dc281a3932b419c5"
        };
        
        const app = !getApps().length ? initializeApp(firebaseConfig) : getApp();
        const db = getFirestore(app);
        const auth = getAuth(app);

        const authLink = document.getElementById('auth-link');
        onAuthStateChanged(auth, user => {
            if (user) {
                authLink.textContent = 'แผงควบคุม';
                authLink.href = 'admin.html';
            } else {
                authLink.textContent = 'เข้าสู่ระบบผู้ดูแล';
                authLink.href = 'login.html';
            }
        });
        
        const loadFooterAndSidebar = async (settings) => {
            const footerPhone = document.getElementById('footer-phone');
            if (settings.footerPhone) footerPhone.textContent = `โทร: ${settings.footerPhone}`;
            
            const footerEmail = document.getElementById('footer-email');
            if (settings.footerEmail) footerEmail.textContent = `อีเมล: ${settings.footerEmail}`;
            
            const footerAddress = document.getElementById('footer-address');
            if (settings.footerAddress) footerAddress.textContent = settings.footerAddress;

            // Reordered social links for the footer
            const footerSocialLinks = {
                'social-line': settings.socialLine,
                'social-fb': settings.socialFacebook,
                'social-tiktok': settings.socialTiktok,
                'social-ig': settings.socialInstagram
            };
            for (const [id, url] of Object.entries(footerSocialLinks)) {
                const linkEl = document.getElementById(id);
                if (linkEl && url) {
                    linkEl.href = url;
                    linkEl.style.display = 'inline-block';
                }
            }
            
            const sidebarSocialContainer = document.getElementById('sidebar-social-links');
            if (sidebarSocialContainer) {
                let linksHTML = '';
                // Reordered social links for the sidebar
                if (settings.socialLine) {
                    linksHTML += `<li><a href="${settings.socialLine}" target="_blank"><img src="icons/line.png" class="sidebar-social-icon" alt="Line"><span>LINE</span></a></li>`;
                }
                if (settings.socialFacebook) {
                    linksHTML += `<li><a href="${settings.socialFacebook}" target="_blank"><img src="icons/messenger.png" class="sidebar-social-icon" alt="Facebook Messenger"><span>Facebook</span></a></li>`;
                }
                if (settings.socialTiktok) {
                    linksHTML += `<li><a href="${settings.socialTiktok}" target="_blank"><img src="icons/tik-tok.png" class="sidebar-social-icon" alt="TikTok"><span>TikTok</span></a></li>`;
                }
                if (settings.socialInstagram) {
                    linksHTML += `<li><a href="${settings.socialInstagram}" target="_blank"><img src="icons/instagram.png" class="sidebar-social-icon" alt="Instagram"><span>Instagram</span></a></li>`;
                }
                sidebarSocialContainer.innerHTML = linksHTML;
            }

            const mapContainer = document.getElementById('footer-map-container');
            if (mapContainer && settings.googleMapsEmbed) {
                mapContainer.innerHTML = settings.googleMapsEmbed;
            }
        };

        const container = document.getElementById('product-detail-container');
        const fetchProductDetails = async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');

            if (!productId) {
                container.innerHTML = '<h1>ไม่พบรหัสสินค้า</h1><p>ไม่พบข้อมูลสุนัขที่คุณต้องการ โปรดกลับไปที่<a href="index.html">หน้าร้าน</a></p>';
                return;
            }

            container.innerHTML = '<p style="text-align: center;">กำลังโหลดข้อมูล...</p>';

            try {
                const productDocRef = doc(db, 'products', productId);
                const settingsDocRef = doc(db, "settings", "siteConfig");
                
                const [productDocSnap, settingsDocSnap] = await Promise.all([
                    getDoc(productDocRef),
                    getDoc(settingsDocRef)
                ]);
                
                const settings = settingsDocSnap.exists() ? settingsDocSnap.data() : {};
                
                loadFooterAndSidebar(settings);

                if (productDocSnap.exists()) {
                    const product = productDocSnap.data();
                    displayProductDetails(product, settings);
                } else {
                    container.innerHTML = '<h1>404 - ไม่พบข้อมูล</h1><p>เราไม่พบสุนัขที่คุณค้นหา อาจถูกลบไปแล้วหรือคุณมีลิงก์ที่ไม่ถูกต้อง <a href="index.html">กลับสู่หน้าร้าน</a></p>';
                    document.title = "ไม่พบข้อมูล - ซีซาร์ เคนเนล";
                }
            } catch (error) {
                console.error("Error fetching product details:", error);
                container.innerHTML = '<p style="color: red; text-align: center;">เกิดข้อผิดพลาดในการโหลดข้อมูล</p>';
            }
        };

        const displayProductDetails = (product, settings) => {
            document.title = `${product.name} - ซีซาร์ เคนเนล`;
            
            let buttonHTML = '';
            if (product.status === 'sold') {
                buttonHTML = `<button class="add-to-cart-button sold-button" disabled>รายการนี้ขายแล้ว</button>`;
            } else {
                const lineBtn = settings.lineUrl ? `
                    <a href="${settings.lineUrl}" target="_blank" rel="noopener noreferrer" class="contact-btn line-btn">
                        <svg fill="white" height="24px" width="24px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 216 216" xml:space="preserve"><g><path d="M108,0C48.353,0,0,48.353,0,108s48.353,108,108,108s108-48.353,108-108S167.647,0,108,0z M156.088,143.435 c-1.571,3.479-5.14,5.912-9.015,5.912c-0.12,0-0.24-0.003-0.36-0.008c-0.891-0.04-1.77-0.16-2.622-0.354 c-1.189-0.271-2.355-0.654-3.484-1.129c-5.918-2.469-11.439-6.34-16.143-11.272c-5.741-5.999-10.43-12.87-13.883-20.315 c-3.32-7.143-5.228-14.65-5.632-22.193c-0.019-0.354,0.013-0.702,0.1-1.043c0.183-0.718,0.51-1.399,0.964-1.999 c0.473-0.621,1.06-1.139,1.73-1.529c1.655-0.965,3.623-1.066,5.362-0.279c1.015,0.46,1.93,1.144,2.69,2.002 c1.637,1.848,2.5,4.232,2.448,6.673c-0.005,0.24-0.021,0.48-0.045,0.718c-0.255,2.479-1.339,4.819-3.111,6.589 c-0.56,0.56-1.121,1.121-1.681,1.681c-0.224,0.224-0.224,0.224-0.448,0.224c0.224,0.224,0.448,0.224,0.672,0.448 c3.136,3.36,6.944,6.272,11.2,8.4c4.48,2.24,9.184,3.136,13.888,2.688c2.464-0.224,4.692-1.344,6.272-3.136 c1.569-1.792,2.466-4.001,2.569-6.31c0.01-0.219,0.005-0.439-0.013-0.655c-0.14-1.74-0.906-3.402-2.18-4.66 c-0.74-0.729-1.644-1.284-2.65-1.621c-1.874-0.626-3.87-0.354-5.464,0.735c-0.584,0.402-1.109,0.894-1.56,1.464 c-0.354,0.448-0.819,0.819-1.344,1.12c-0.224,0.224-0.448,0.224-0.672,0c-0.224-0.224-0.224-0.448-0.224-0.672 c0-0.224,0-0.448,0.224-0.672c0.224-0.224,0.224-0.224,0.448-0.448c2.912-3.36,6.944-5.376,11.2-5.376 c2.912,0,5.599,0.893,7.839,2.46c2.83,1.96,4.734,5.011,5.18,8.517C157.072,137.91,157.168,140.713,156.088,143.435z M83,73 c0-4.418,3.582-8,8-8s8,3.582,8,8s-3.582,8-8,8S83,77.418,83,73z M60,73c0-4.418,3.582-8,8-8s8,3.582,8,8s-3.582,8-8,8 S60,77.418,60,73z M52,99c-4.418,0-8,3.582-8,8s3.582,8,8,8s8-3.582,8-8S56.418,99,52,99z"/></g></svg>
                        สั่งซื้อทาง LINE
                    </a>` : '';
                
                const messengerBtn = settings.messengerUrl ? `
                    <a href="${settings.messengerUrl}" target="_blank" rel="noopener noreferrer" class="contact-btn messenger-btn">
                        <svg fill="white" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M12,2C6.477,2,2,6.477,2,12c0,3.453,1.782,6.513,4.5,8.243V22l3.493-2.022C10.63,20.05,11.31,20.08,12,20.08 c5.523,0,10-4.514,10-8.08c0-5.523-4.477-10-10-10z M13.192,14.242l-1.38,1.458l-3.38-3.54l5.352-5.61l1.38,1.458l3.38,3.54 L13.192,14.242z"></path></svg>
                        แชทหาเรา
                    </a>` : '';
                
                buttonHTML = `<div class="contact-buttons-container">${lineBtn}${messengerBtn}</div>`;
            }
            
            const hasDiscount = product.discountPrice > 0 && product.discountPrice < product.price;
            let priceHTML = `<span class="discounted-price">${product.price.toLocaleString('th-TH')} บาท</span>`;
            if (hasDiscount) {
                priceHTML = `
                    <span class="original-price">${product.price.toLocaleString('th-TH')}</span>
                    <span class="discounted-price">${product.discountPrice.toLocaleString('th-TH')} บาท</span>
                `;
            }

            const dewormedHTML = product.dewormed === true
                ? `<span class="status-icon check">✓</span> ทำแล้ว`
                : `<span class="status-icon cross">✗</span> ยังไม่ได้ทำ`;

            let mainSlidesHTML = '';
            let thumbnailsHTML = '';
            const imageUrls = product.imageUrls && product.imageUrls.length > 0 
                ? product.imageUrls 
                : ['https://via.placeholder.com/800'];

            imageUrls.forEach((url, index) => {
                mainSlidesHTML += `<div class="gallery-slide"><img src="${url}" alt="รูปของ ${product.name} - ${index + 1}"></div>`;
                thumbnailsHTML += `<div class="thumbnail-item"><img src="${url}" alt="Thumbnail of ${product.name} - ${index + 1}"></div>`;
            });

            const galleryHTML = `
                <div class="product-gallery-container">
                    <div class="main-image-wrapper">
                        <div class="gallery-track" id="product-gallery-track">${mainSlidesHTML}</div>
                        <button class="gallery-arrow prev" id="product-gallery-prev">&#10094;</button>
                        <button class="gallery-arrow next" id="product-gallery-next">&#10095;</button>
                    </div>
                    <div class="thumbnail-wrapper" id="thumbnail-wrapper">
                        <div class="thumbnail-track" id="thumbnail-track">${thumbnailsHTML}</div>
                    </div>
                </div>
            `;

            container.innerHTML = `
                ${galleryHTML}
                <div class="detail-info">
                    <h1>${product.name}</h1>
                    <div class="price">${priceHTML}</div>
                    <p class="description">${product.description || 'ไม่มีคำอธิบายเพิ่มเติม'}</p>
                    
                    <ul class="details-list">
                        <li><strong>อายุ:</strong><span>${product.age}</span></li>
                        <li><strong>เพศ:</strong><span>${product.gender}</span></li>
                        <li><strong>ตัวสี:</strong><span>${product.color}</span></li>
                        <li><strong>ตาสี:</strong><span>${product.eyeColor || '-'}</span></li>
                        <li><strong>วัคซีน:</strong><span>${product.vaccine || '-'}</span></li>
                        <li><strong>ถ่ายพยาธิ:</strong><span>${dewormedHTML}</span></li>
                    </ul>
                    ${buttonHTML}
                </div>
            `;
            
            initializeProductGallery();
        };
        
        const initializeProductGallery = () => {
            const track = document.getElementById('product-gallery-track');
            const prevButton = document.getElementById('product-gallery-prev');
            const nextButton = document.getElementById('product-gallery-next');
            const thumbnailTrack = document.getElementById('thumbnail-track');
            
            if (!track || !thumbnailTrack) return;

            const slides = Array.from(track.children);
            const thumbnails = Array.from(thumbnailTrack.children);
            
            if (slides.length <= 1) {
                prevButton.style.display = 'none';
                nextButton.style.display = 'none';
                thumbnailTrack.parentElement.style.display = 'none';
                return;
            }

            let currentIndex = 0;
            let autoSlideInterval;

            const showSlide = (index) => {
                currentIndex = (index + slides.length) % slides.length;

                const slideWidth = slides[0].getBoundingClientRect().width;
                track.style.transform = `translateX(-${slideWidth * currentIndex}px)`;

                thumbnails.forEach((thumb, i) => thumb.classList.toggle('active', i === currentIndex));

                const activeThumbnail = thumbnails[currentIndex];
                if (activeThumbnail) {
                    activeThumbnail.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            };

            const advanceSlide = (direction = 1) => showSlide(currentIndex + direction);
            const startAutoSlide = () => {
                stopAutoSlide();
                autoSlideInterval = setInterval(() => advanceSlide(1), 5000);
            };
            const stopAutoSlide = () => clearInterval(autoSlideInterval);

            nextButton.addEventListener('click', () => { advanceSlide(1); startAutoSlide(); });
            prevButton.addEventListener('click', () => { advanceSlide(-1); startAutoSlide(); });
            thumbnails.forEach((thumb, index) => thumb.addEventListener('click', () => { showSlide(index); startAutoSlide(); }));
            
            window.addEventListener('resize', () => {
                track.style.transition = 'none';
                showSlide(currentIndex);
                setTimeout(() => { track.style.transition = 'transform 0.5s ease-in-out'; }, 50);
            });

            showSlide(0);
            startAutoSlide();
        };

        fetchProductDetails();
    </script>
</body>
</html>