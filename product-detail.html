<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ข้อมูลสุนัข - ซีซาร์ เคนเนล</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="shop-layout">
        <aside class="sidebar" id="sidebar">
            <div>
                <div class="sidebar-logo">Cesar Kennel<span>.</span></div>
                <nav class="sidebar-nav">
                    <h3>เมนู</h3>
                    <ul>
                        <li><a href="index.html">สุนัขทั้งหมด</a></li>
                        <li><a href="index.html?gender=ผู้">เพศผู้</a></li>
                        <li><a href="index.html?gender=เมีย">เพศเมีย</a></li>
                    </ul>
                </nav>

                <div class="sidebar-follow">
                    <h3>ช่องทางติดตาม</h3>
                    <ul class="sidebar-social-links" id="sidebar-social-links">
                        <!-- Links will be injected by script -->
                    </ul>
                </div>
            </div>
            <div class="sidebar-footer">
                &copy; 2568 ซีซาร์ เคนเนล
                <p><a href="login.html" id="auth-link">เข้าสู่ระบบผู้ดูแล</a></p>
            </div>
        </aside>
        
        <main class="main-content" id="main-content">
            <header class="mobile-header">
                <div class="mobile-logo">Cesar<span>.</span></div>
                <button class="mobile-menu-button" id="menu-toggle">☰</button>
            </header>

            <div class="product-detail-grid" id="product-detail-container">
                <!-- Loading message or dynamic content appears here -->
            </div>
        </main>
    </div>

    <footer class="site-footer">
        <div class="footer-grid">
            <div class="footer-info">
                <h3 class="footer-logo">ซีซาร์ เคนเนล</h3>
                <p class="footer-description">ฟาร์มสุนัขเกรดพรีเมียม จัดส่งทั่วประเทศ</p>
                <div class="footer-contact">
                    <span id="footer-phone"></span>
                    <span id="footer-email"></span>
                </div>
                <div class="social-links">
                    <a href="#" id="social-fb" aria-label="Facebook" target="_blank" style="display: none;">FB</a>
                    <a href="#" id="social-ig" aria-label="Instagram" target="_blank" style="display: none;">IG</a>
                    <a href="#" id="social-line" aria-label="Line" target="_blank" style="display: none;">LINE</a>
                    <a href="#" id="social-tiktok" aria-label="TikTok" target="_blank" style="display: none;">TT</a>
                </div>
            </div>
            <div class="footer-map" id="footer-map-container">
                <!-- Google Map Iframe will be injected here by script -->
            </div>
        </div>
    </footer>


    <script src="script.js"></script>

    <script type="module">
        import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA85L7n2CGKocgWg-Z8TsNlUN9AVVJguBQ",
            authDomain: "cesarkennel.firebaseapp.com",
            projectId: "cesarkennel",
            storageBucket: "cesarkennel.firebasestorage.app",
            messagingSenderId: "512752480416",
            appId: "1:512752480416:web:c71aa9dc281a3932b419c5"
        };
        
        const app = !getApps().length ? initializeApp(firebaseConfig) : getApp();
        const db = getFirestore(app);
        const auth = getAuth(app);

        const authLink = document.getElementById('auth-link');
        onAuthStateChanged(auth, user => {
            if (user) {
                authLink.textContent = 'แผงควบคุม';
                authLink.href = 'admin.html';
            } else {
                authLink.textContent = 'เข้าสู่ระบบผู้ดูแล';
                authLink.href = 'login.html';
            }
        });
        
        const loadFooterAndSidebar = async (settings) => {
            const footerPhone = document.getElementById('footer-phone');
            if (settings.footerPhone) footerPhone.textContent = `โทร: ${settings.footerPhone}`;
            
            const footerEmail = document.getElementById('footer-email');
            if (settings.footerEmail) footerEmail.textContent = `อีเมล: ${settings.footerEmail}`;
            
            const footerSocialLinks = {
                'social-fb': settings.socialFacebook,
                'social-ig': settings.socialInstagram,
                'social-line': settings.socialLine,
                'social-tiktok': settings.socialTiktok
            };
            for (const [id, url] of Object.entries(footerSocialLinks)) {
                const linkEl = document.getElementById(id);
                if (linkEl && url) {
                    linkEl.href = url;
                    linkEl.style.display = 'inline-block';
                }
            }
            
            const sidebarSocialContainer = document.getElementById('sidebar-social-links');
            if (sidebarSocialContainer) {
                let linksHTML = '';
                if (settings.socialFacebook) {
                    linksHTML += `<li><a href="${settings.socialFacebook}" target="_blank"><span class="sidebar-social-icon"><svg viewBox="0 0 24 24"><path d="M14 13.5h2.5l1-4H14v-2c0-1.03 0-2 2-2h1.5V2.14c-.326-.043-1.557-.14-2.857-.14C11.928 2 10 3.657 10 6.7v2.8H7v4h3v9h4v-9z"/></svg></span><span>Facebook</span></a></li>`;
                }
                if (settings.socialInstagram) {
                    linksHTML += `<li><a href="${settings.socialInstagram}" target="_blank"><span class="sidebar-social-icon"><svg viewBox="0 0 24 24"><path d="M12 2c2.717 0 3.056.01 4.122.06 1.065.05 1.79.217 2.428.465.66.254 1.216.598 1.772 1.153a4.908 4.908 0 0 1 1.153 1.772c.247.637.415 1.363.465 2.428.047 1.066.06 1.405.06 4.122s-.013 3.056-.06 4.122c-.05 1.065-.218 1.79-.465 2.428a4.883 4.883 0 0 1-1.153 1.772 4.915 4.915 0 0 1-1.772 1.153c-.637.247-1.363.415-2.428.465-1.066.047-1.405.06-4.122.06s-3.056-.013-4.122-.06c-1.065-.05-1.79-.218-2.428-.465a4.89 4.89 0 0 1-1.772-1.153 4.904 4.904 0 0 1-1.153-1.772c-.248-.637-.415-1.363-.465-2.428C2.013 15.056 2 14.717 2 12s.013-3.056.06-4.122c.05-1.065.217-1.79.465-2.428a4.88 4.88 0 0 1 1.153-1.772A4.902 4.902 0 0 1 5.45 2.525c.638-.248 1.362-.415 2.428-.465C8.944 2.013 9.283 2 12 2zm0 5a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm6.5-3c-.828 0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5 1.5-.672 1.5-1.5-.672-1.5-1.5-1.5z"/></svg></span><span>Instagram</span></a></li>`;
                }
                // MODIFICATION START: Replaced SVGs with letters
                if (settings.socialLine) {
                    linksHTML += `<li><a href="${settings.socialLine}" target="_blank"><span class="sidebar-social-icon">L</span><span>LINE</span></a></li>`;
                }
                if (settings.socialTiktok) {
                    linksHTML += `<li><a href="${settings.socialTiktok}" target="_blank"><span class="sidebar-social-icon">T</span><span>TikTok</span></a></li>`;
                }
                // MODIFICATION END
                sidebarSocialContainer.innerHTML = linksHTML;
            }

            const mapContainer = document.getElementById('footer-map-container');
            if (mapContainer && settings.googleMapsEmbed) {
                mapContainer.innerHTML = settings.googleMapsEmbed;
            }
        };

        const container = document.getElementById('product-detail-container');
        const fetchProductDetails = async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');

            if (!productId) {
                container.innerHTML = '<h1>ไม่พบรหัสสินค้า</h1><p>ไม่พบข้อมูลสุนัขที่คุณต้องการ โปรดกลับไปที่<a href="index.html">หน้าร้าน</a></p>';
                return;
            }

            container.innerHTML = '<p style="text-align: center;">กำลังโหลดข้อมูล...</p>';

            try {
                const productDocRef = doc(db, 'products', productId);
                const settingsDocRef = doc(db, "settings", "siteConfig");
                
                const [productDocSnap, settingsDocSnap] = await Promise.all([
                    getDoc(productDocRef),
                    getDoc(settingsDocRef)
                ]);
                
                const settings = settingsDocSnap.exists() ? settingsDocSnap.data() : {};
                
                loadFooterAndSidebar(settings);

                if (productDocSnap.exists()) {
                    const product = productDocSnap.data();
                    displayProductDetails(product, settings);
                } else {
                    container.innerHTML = '<h1>404 - ไม่พบข้อมูล</h1><p>เราไม่พบสุนัขที่คุณค้นหา อาจถูกลบไปแล้วหรือคุณมีลิงก์ที่ไม่ถูกต้อง <a href="index.html">กลับสู่หน้าร้าน</a></p>';
                    document.title = "ไม่พบข้อมูล - ซีซาร์ เคนเนล";
                }
            } catch (error) {
                console.error("Error fetching product details:", error);
                container.innerHTML = '<p style="color: red; text-align: center;">เกิดข้อผิดพลาดในการโหลดข้อมูล</p>';
            }
        };

        const displayProductDetails = (product, settings) => {
            document.title = `${product.name} - ซีซาร์ เคนเนล`;
            
            let buttonHTML = '';
            if (product.status === 'sold') {
                buttonHTML = `<button class="add-to-cart-button sold-button" disabled>รายการนี้ขายแล้ว</button>`;
            } else {
                const lineBtn = settings.lineUrl ? `
                    <a href="${settings.lineUrl}" target="_blank" rel="noopener noreferrer" class="contact-btn line-btn">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 6C10.3431 6 9 7.34315 9 9C9 10.6569 10.3431 12 12 12C13.6569 12 15 10.6569 15 9C15 7.34315 13.6569 6 12 6Z" fill="white"></path><path d="M18 16.5C18 14.0147 15.3137 12 12 12C8.68629 12 6 14.0147 6 16.5V18H18V16.5Z" fill="white"></path></svg>
                        สั่งซื้อทาง LINE
                    </a>` : '';
                
                const messengerBtn = settings.messengerUrl ? `
                    <a href="${settings.messengerUrl}" target="_blank" rel="noopener noreferrer" class="contact-btn messenger-btn">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17.5H11V14L8.5 12.5L13 7.5V11H15V14L13 15.5V17.5Z" fill="white"></path></svg>
                        แชทหาเรา
                    </a>` : '';
                
                buttonHTML = `<div class="contact-buttons-container">${lineBtn}${messengerBtn}</div>`;
            }
            
            const hasDiscount = product.discountPrice > 0 && product.discountPrice < product.price;
            let priceHTML = `<span class="discounted-price">${product.price.toLocaleString('th-TH')} บาท</span>`;
            if (hasDiscount) {
                priceHTML = `
                    <span class="original-price">${product.price.toLocaleString('th-TH')}</span>
                    <span class="discounted-price">${product.discountPrice.toLocaleString('th-TH')} บาท</span>
                `;
            }

            const dewormedHTML = product.dewormed === true
                ? `<span class="status-icon check">✓</span>`
                : `<span class="status-icon cross">✗</span>`;

            let mainSlidesHTML = '';
            let thumbnailsHTML = '';
            const imageUrls = product.imageUrls && product.imageUrls.length > 0 
                ? product.imageUrls 
                : ['https://via.placeholder.com/800'];

            imageUrls.forEach((url, index) => {
                mainSlidesHTML += `<div class="gallery-slide"><img src="${url}" alt="รูปของ ${product.name} - ${index + 1}"></div>`;
                thumbnailsHTML += `<div class="thumbnail-item"><img src="${url}" alt="Thumbnail of ${product.name} - ${index + 1}"></div>`;
            });

            const galleryHTML = `
                <div class="product-gallery-container">
                    <div class="main-image-wrapper">
                        <div class="gallery-track" id="product-gallery-track">${mainSlidesHTML}</div>
                        <button class="gallery-arrow prev" id="product-gallery-prev">&#10094;</button>
                        <button class="gallery-arrow next" id="product-gallery-next">&#10095;</button>
                    </div>
                    <div class="thumbnail-wrapper" id="thumbnail-wrapper">
                        <div class="thumbnail-track" id="thumbnail-track">${thumbnailsHTML}</div>
                    </div>
                </div>
            `;

            container.innerHTML = `
                ${galleryHTML}
                <div class="detail-info">
                    <h1>${product.name}</h1>
                    <div class="price">${priceHTML}</div>
                    <p class="description">${product.description || 'ไม่มีคำอธิบายเพิ่มเติม'}</p>
                    
                    <ul class="details-list">
                        <li><strong>อายุ:</strong><span>${product.age}</span></li>
                        <li><strong>เพศ:</strong><span>${product.gender}</span></li>
                        <li><strong>ตัวสี:</strong><span>${product.color}</span></li>
                        <li><strong>ตาสี:</strong><span>${product.eyeColor || '-'}</span></li>
                        <li><strong>วัคซีน:</strong><span>${product.vaccine || '-'}</span></li>
                        <li><strong>ถ่ายพยาธิ:</strong><span>${dewormedHTML}</span></li>
                    </ul>
                    ${buttonHTML}
                </div>
            `;
            
            initializeProductGallery();
        };
        
        const initializeProductGallery = () => {
            const track = document.getElementById('product-gallery-track');
            const prevButton = document.getElementById('product-gallery-prev');
            const nextButton = document.getElementById('product-gallery-next');
            const thumbnailTrack = document.getElementById('thumbnail-track');
            
            if (!track || !thumbnailTrack) return;

            const slides = Array.from(track.children);
            const thumbnails = Array.from(thumbnailTrack.children);
            
            if (slides.length <= 1) {
                prevButton.style.display = 'none';
                nextButton.style.display = 'none';
                thumbnailTrack.parentElement.style.display = 'none';
                return;
            }

            let currentIndex = 0;
            let autoSlideInterval;

            const showSlide = (index) => {
                currentIndex = (index + slides.length) % slides.length;

                const slideWidth = slides[0].getBoundingClientRect().width;
                track.style.transform = `translateX(-${slideWidth * currentIndex}px)`;

                thumbnails.forEach((thumb, i) => thumb.classList.toggle('active', i === currentIndex));

                const activeThumbnail = thumbnails[currentIndex];
                if (activeThumbnail) {
                    activeThumbnail.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            };

            const advanceSlide = (direction = 1) => showSlide(currentIndex + direction);
            const startAutoSlide = () => {
                stopAutoSlide();
                autoSlideInterval = setInterval(() => advanceSlide(1), 5000);
            };
            const stopAutoSlide = () => clearInterval(autoSlideInterval);

            nextButton.addEventListener('click', () => { advanceSlide(1); startAutoSlide(); });
            prevButton.addEventListener('click', () => { advanceSlide(-1); startAutoSlide(); });
            thumbnails.forEach((thumb, index) => thumb.addEventListener('click', () => { showSlide(index); startAutoSlide(); }));
            
            window.addEventListener('resize', () => {
                track.style.transition = 'none';
                showSlide(currentIndex);
                setTimeout(() => { track.style.transition = 'transform 0.5s ease-in-out'; }, 50);
            });

            showSlide(0);
            startAutoSlide();
        };

        fetchProductDetails();
    </script>
</body>
</html>