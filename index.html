<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ซีซาร์ เคนเนล - ฟาร์มสุนัขคุณภาพ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="shop-layout">
        <aside class="sidebar" id="sidebar">
            <div>
                <div class="sidebar-logo">Cesar<span>.</span></div>
                <nav class="sidebar-nav">
                    <h3>เมนู</h3>
                    <ul>
                        <li><a href="index.html" data-filter="all">สุนัขทั้งหมด</a></li>
                        <li><a href="index.html?gender=ผู้" data-filter="ผู้">เพศผู้</a></li>
                        <li><a href="index.html?gender=เมีย" data-filter="เมีย">เพศเมีย</a></li>
                        <li><a href="#">เกี่ยวกับเรา</a></li>
                    </ul>
                </nav>
            </div>
            <div class="sidebar-footer">
                &copy; 2568 ซีซาร์ เคนเนล
                <p><a href="login.html" id="auth-link">เข้าสู่ระบบผู้ดูแล</a></p>
            </div>
        </aside>
        
        <main class="main-content">
            <header class="mobile-header">
                <div class="mobile-logo">Cesar<span>.</span></div>
                <button class="mobile-menu-button" id="menu-toggle">☰</button>
            </header>

            <section class="hero-section">
                <div class="hero-image-container">
                    <img id="hero-image" src="cesar-kennel-logo.png" alt="Cesar Kennel Logo">
                    
                    <div class="hero-text-overlay">
                        <h1>CESAR KENNEL</h1>
                        <p>ฟาร์มไซบีเรียนฮัสกี้เชียงใหม่</p>
                        <p>มีลูกสุนัขตลอดทั้งปีรวมถึงอลาสกันมาลามิวท์</p>
                        <p class="hero-price">ราคาเริ่มต้น 5,000 บาท</p>
                    </div>
                </div>
                <div class="marquee-container">
                    <p id="marquee-text-display" class="marquee-text">✨ สุนัขสุขภาพดี เกรดพรีเมียม พร้อมย้ายบ้านแล้ววันนี้! ✨</p>
                </div>
            </section>

            <header class="desktop-header">
                <h1>เพื่อนคู่ใจที่ดีที่สุด</h1>
                <p>สุนัขทุกตัวถูกเลี้ยงด้วยความรัก พร้อมที่จะเป็นสมาชิกใหม่ในครอบครัวคุณ</p>
            </header>

            <div class="product-grid" id="product-grid">
                <!-- Content will be loaded dynamically. -->
            </div>

            <div class="pagination-container" id="pagination"></div>

            <!-- NEW: "About Us" Section -->
            <section id="about-section" class="about-section" style="display: none;">
                <div class="about-text">
                    <h2 id="about-headline-display"></h2>
                    <p id="about-paragraph-display"></p>
                </div>
                <div class="about-images">
                    <img id="about-image-1-display" src="" alt="About us image 1">
                    <img id="about-image-2-display" src="" alt="About us image 2">
                </div>
            </section>
            
            <section id="gallery-section" class="gallery-section" style="display: none;">
                <h2>แกลเลอรี่</h2>
                <p class="gallery-subtitle">พบกับน้องหมาน่ารักจากฟาร์มของเราได้ที่นี่</p>
                <div class="gallery-slider">
                    <div class="gallery-track" id="gallery-track">
                        <!-- Images will be injected here -->
                    </div>
                    <button class="gallery-arrow prev" id="gallery-prev">&#10094;</button>
                    <button class="gallery-arrow next" id="gallery-next">&#10095;</button>
                </div>
            </section>

        </main>
    </div>

    <footer class="site-footer">
        <div class="footer-content">
            <h3 class="footer-logo">ซีซาร์ เคนเนล</h3>
            <p class="footer-description">ฟาร์มสุนัขเกรดพรีเมียม จัดส่งทั่วประเทศ</p>
            <div class="footer-contact">
                <span>โทร: 081-234-5678</span> | <span>อีเมล: contact@cesarkennel.com</span>
            </div>
            <div class="social-links">
                <a href="#" aria-label="Facebook">FB</a> <a href="#" aria-label="Instagram">IG</a> <a href="#" aria-label="Line">LINE</a>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>

    <script type="module">
        import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, collection, query, where, orderBy, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA85L7n2CGKocgWg-Z8TsNlUN9AVVJguBQ",
            authDomain: "cesarkennel.firebaseapp.com",
            projectId: "cesarkennel",
            storageBucket: "cesarkennel.firebasestorage.app",
            messagingSenderId: "512752480416",
            appId: "1:512752480416:web:c71aa9dc281a3932b419c5"
        };
        
        const app = !getApps().length ? initializeApp(firebaseConfig) : getApp();
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        const authLink = document.getElementById('auth-link');
        onAuthStateChanged(auth, user => {
            if (user) {
                authLink.textContent = 'แผงควบคุม';
                authLink.href = 'admin.html';
            } else {
                authLink.textContent = 'เข้าสู่ระบบผู้ดูแล';
                authLink.href = 'login.html';
            }
        });

        const updateActiveMenu = (filter) => {
            const menuLinks = document.querySelectorAll('.sidebar-nav a[data-filter]');
            menuLinks.forEach(link => {
                link.classList.remove('active');
                if (link.dataset.filter === filter) {
                    link.classList.add('active');
                }
            });
        };
        
        const initializeGallerySlider = () => {
            const track = document.getElementById('gallery-track');
            const prevButton = document.getElementById('gallery-prev');
            const nextButton = document.getElementById('gallery-next');
            if (!track || !prevButton || !nextButton) return;

            const slides = Array.from(track.children);
            if (slides.length <= 1) {
                prevButton.style.display = 'none';
                nextButton.style.display = 'none';
                return;
            }

            let currentIndex = 0;
            let autoSlideInterval;

            const advanceSlide = () => {
                currentIndex = (currentIndex === slides.length - 1) ? 0 : currentIndex + 1;
                setSlidePosition(currentIndex);
            };
            
            const startAutoSlide = () => {
                stopAutoSlide();
                autoSlideInterval = setInterval(advanceSlide, 5000);
            };
            
            const stopAutoSlide = () => {
                clearInterval(autoSlideInterval);
            };

            const setSlidePosition = (index) => {
                const slideWidth = slides[0].getBoundingClientRect().width;
                track.style.transform = `translateX(-${slideWidth * index}px)`;
            };

            nextButton.addEventListener('click', () => {
                advanceSlide();
                startAutoSlide();
            });

            prevButton.addEventListener('click', () => {
                currentIndex = (currentIndex === 0) ? slides.length - 1 : currentIndex - 1;
                setSlidePosition(currentIndex);
                startAutoSlide();
            });
            
            window.addEventListener('resize', () => {
                const newSlideWidth = slides[0].getBoundingClientRect().width;
                track.style.transition = 'none';
                track.style.transform = `translateX(-${newSlideWidth * currentIndex}px)`;
                setTimeout(() => { track.style.transition = 'transform 0.5s ease-in-out'; }, 50);
            });

            startAutoSlide();
        };

        const loadSiteSettings = async () => {
            const settingsRef = doc(db, "settings", "siteConfig");
            const docSnap = await getDoc(settingsRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                
                // General Settings
                if (data.coverImageUrl) document.getElementById('hero-image').src = data.coverImageUrl;
                if (data.marqueeText) document.getElementById('marquee-text-display').textContent = data.marqueeText;
                
                // About Section
                const aboutSection = document.getElementById('about-section');
                if (data.aboutHeadline && data.aboutParagraph && data.aboutImageUrl1 && data.aboutImageUrl2) {
                    document.getElementById('about-headline-display').textContent = data.aboutHeadline;
                    document.getElementById('about-paragraph-display').textContent = data.aboutParagraph;
                    document.getElementById('about-image-1-display').src = data.aboutImageUrl1;
                    document.getElementById('about-image-2-display').src = data.aboutImageUrl2;
                    aboutSection.style.display = 'grid'; // Use grid to activate the layout
                }

                // Gallery Section
                const gallerySection = document.getElementById('gallery-section');
                const galleryTrack = document.getElementById('gallery-track');
                if (data.galleryImageUrls && Array.isArray(data.galleryImageUrls) && data.galleryImageUrls.length > 0) {
                    galleryTrack.innerHTML = '';
                    data.galleryImageUrls.forEach(url => {
                        galleryTrack.innerHTML += `<div class="gallery-slide"><img src="${url}" alt="Gallery Image"></div>`;
                    });
                    gallerySection.style.display = 'block';
                    initializeGallerySlider();
                }
            }
        };

        const productGrid = document.getElementById('product-grid');
        const fetchAndDisplayProducts = async () => {
            productGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1;">กำลังโหลดข้อมูลสุนัข...</p>';
            
            const urlParams = new URLSearchParams(window.location.search);
            const genderFilter = urlParams.get('gender');
            updateActiveMenu(genderFilter || 'all');

            try {
                const productsRef = collection(db, "products");
                let q = genderFilter ? query(productsRef, where("gender", "==", genderFilter), orderBy("orderPosition", "asc")) : query(productsRef, orderBy("orderPosition", "asc"));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    productGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1;">ตอนนี้ยังไม่มีสุนัขตรงตามเงื่อนไขค่ะ</p>';
                    return;
                }
                
                productGrid.innerHTML = '';
                querySnapshot.forEach(doc => { productGrid.innerHTML += createProductCardHTML(doc.data(), doc.id); });
                initializePagination();

            } catch (error) {
                console.error("Error fetching products:", error);
                productGrid.innerHTML = `<p style="color: red; text-align: center; grid-column: 1 / -1;">เกิดข้อผิดพลาดในการโหลดข้อมูล</p>`;
            }
        };

        const createProductCardHTML = (product, id) => {
            const price = product.price || 0;
            const discountPrice = product.discountPrice || 0;
            const hasDiscount = discountPrice > 0 && discountPrice < price;
            let priceHTML = `<div class="card-price">${price.toLocaleString('th-TH')} บาท</div>`;
            if (hasDiscount) priceHTML = `<div class="card-price"><span class="original-price">${price.toLocaleString('th-TH')}</span><span class="discounted-price">${discountPrice.toLocaleString('th-TH')} บาท</span></div>`;
            const statusMap = { available: 'available', preordered: 'preordered', sold: 'sold' };
            const statusInfo = { class: statusMap[product.status] || 'available', text: {available:'พร้อมย้ายบ้าน', preordered:'ติดจอง', sold:'ขายแล้ว'}[product.status] || 'พร้อมย้ายบ้าน' };
            return `<a href="product-detail.html?id=${id}" class="product-card ${product.status === 'sold' ? 'sold-item' : ''}"><div class="card-image-container"><span class="card-status ${statusInfo.class}">${statusInfo.text}</span><img src="${product.thumbnailUrl || 'https://via.placeholder.com/400'}" alt="${product.name || 'สุนัข'}"></div><div class="card-content"><h3>${product.name || 'ไม่มีชื่อ'}</h3><div class="card-details"><span>เพศ${product.gender || '-'}</span><span>${product.age || '-'}</span></div>${priceHTML}</div></a>`;
        };
        
        const initializePagination = () => { /* ... Pagination logic remains unchanged ... */ };

        loadSiteSettings();
        fetchAndDisplayProducts();
    </script>
</body>
</html>