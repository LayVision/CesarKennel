<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ปอมปอม บูทีค</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="shop-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div>
                <div class="sidebar-logo">PomPom<span>.</span></div>
                <nav class="sidebar-nav">
                    <h3>เมนู</h3>
                    <ul>
                        <li><a href="index.html" class="active">น้องหมาทั้งหมด</a></li>
                    </ul>
                </nav>
            </div>
            <div class="sidebar-footer">
                &copy; 2568 ปอมปอม บูทีค
                <p><a href="login.html" id="auth-link">เข้าสู่ระบบผู้ดูแล</a></p>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="mobile-header">
                <div class="mobile-logo">PomPom<span>.</span></div>
                <button class="mobile-menu-button" id="menu-toggle">☰</button>
            </header>

            <section class="hero-section">
                 <div class="hero-image-container">
                    <img src="https://images.pexels.com/photos/1805164/pexels-photo-1805164.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Cover Image">
                </div>
                <div class="marquee-container">
                    <p class="marquee-text">✨ น้องหมาสุขภาพดี เกรดพรีเมียม พร้อมย้ายบ้านแล้ววันนี้! ✨</p>
                </div>
            </section>

            <header class="desktop-header">
                <h1>เพื่อนคู่ใจแสนน่ารัก</h1>
                <p>น้องหมาทุกตัวถูกเลี้ยงด้วยความรัก พร้อมที่จะเป็นสมาชิกใหม่ในครอบครัวคุณ</p>
            </header>

            <div class="product-grid" id="product-grid">
                <p>กำลังโหลดข้อมูลน้องหมา...</p>
            </div>

            <div class="pagination-container" id="pagination"></div>
        </main>
    </div>

    <!-- Firebase and Page Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="script.js"></script>

    <script>
        // Define Firebase Config
        const firebaseConfig = {
          apiKey: "AIzaSyA85L7n2CGKocgWg-Z8TsNlUN9AVVJguBQ",
          authDomain: "cesarkennel.firebaseapp.com",
          projectId: "cesarkennel",
          storageBucket: "cesarkennel.firebasestorage.app",
          messagingSenderId: "512752480416",
          appId: "1:512752480416:web:c71aa9dc281a3932b419c5"
        };
        const app = firebase.initializeApp(firebaseConfig);

        // --- DYNAMIC AUTH LINK ---
        firebase.auth().onAuthStateChanged(function(user) {
            const authLink = document.getElementById('auth-link');
            if (user) {
                authLink.textContent = 'แผงควบคุม';
                authLink.href = 'admin.html';
            } else {
                authLink.textContent = 'เข้าสู่ระบบผู้ดูแล';
                authLink.href = 'login.html';
            }
        });

        // --- PAGE LOGIC ---
        const db = firebase.firestore();
        const productGrid = document.getElementById('product-grid');
        const paginationContainer = document.getElementById('pagination');

        // Functions createDogCard, fetchAndDisplayDogs, setupPagination remain the same
        function createDogCard(dogData, docId) {
            const card = document.createElement('a');
            card.href = `product-detail.html?id=${docId}`;
            card.className = `product-card ${dogData.status === 'sold' ? 'sold-item' : ''}`;

            let statusText = 'พร้อมย้ายบ้าน';
            if (dogData.status === 'preordered') statusText = 'ติดจอง';
            if (dogData.status === 'sold') statusText = 'ขายแล้ว';
            
            const priceHtml = dogData.discountPrice && dogData.discountPrice > 0
                ? `<span class="original-price">${dogData.price.toLocaleString()}</span> <span class="discounted-price">${dogData.discountPrice.toLocaleString()} บาท</span>`
                : `${dogData.price.toLocaleString()} บาท`;

            card.innerHTML = `
                <div class="card-image-container">
                    <span class="card-status ${dogData.status}">${statusText}</span>
                    <img src="${dogData.imageUrls && dogData.imageUrls.length > 0 ? dogData.imageUrls[0] : 'https://via.placeholder.com/400'}" alt="${dogData.name}">
                </div>
                <div class="card-content">
                    <h3>${dogData.name}</h3>
                    <div class="card-details">
                        <span>${dogData.gender}</span>
                        <span>${dogData.age}</span>
                    </div>
                    <div class="card-price">${priceHtml}</div>
                </div>
            `;
            return card;
        }

        async function fetchAndDisplayDogs() {
            productGrid.innerHTML = '<p>กำลังโหลดข้อมูลน้องหมา...</p>';
            try {
                const dogsSnapshot = await db.collection("dogs").orderBy("order", "asc").get();
                productGrid.innerHTML = ''; 

                if (dogsSnapshot.empty) {
                    productGrid.innerHTML = '<p>ยังไม่มีน้องหมาในระบบค่ะ</p>';
                    return;
                }

                const allItems = [];
                dogsSnapshot.forEach(doc => {
                    const dogCard = createDogCard(doc.data(), doc.id);
                    productGrid.appendChild(dogCard);
                    allItems.push(dogCard);
                });
                
                setupPagination(allItems);

            } catch (error) {
                console.error("Error fetching dogs: ", error);
                productGrid.innerHTML = "<p>เกิดข้อผิดพลาดในการโหลดข้อมูล โปรดลองอีกครั้ง</p>";
            }
        }
        
        function setupPagination(allItems) {
             const itemsPerPage = 6;
            const totalPages = Math.ceil(allItems.length / itemsPerPage);
            const paginationContainer = document.getElementById('pagination');
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }

            const displayPage = (page) => {
                page = Math.max(1, Math.min(page, totalPages));
                const startIndex = (page - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                
                allItems.forEach((item, index) => {
                    item.style.display = (index >= startIndex && index < endIndex) ? 'block' : 'none';
                });

                paginationContainer.innerHTML = '';
                
                const prevButton = document.createElement('a');
                prevButton.classList.add('page-btn');
                prevButton.textContent = 'ก่อนหน้า';
                prevButton.href = `?page=${page - 1}`;
                if (page === 1) { prevButton.classList.add('disabled'); }
                paginationContainer.appendChild(prevButton);

                for (let i = 1; i <= totalPages; i++) {
                    const pageButton = document.createElement('a');
                    pageButton.classList.add('page-btn');
                    pageButton.textContent = i;
                    pageButton.href = (i === 1) ? window.location.pathname.split('?')[0] : `?page=${i}`;
                    if (i === page) { pageButton.classList.add('active'); }
                    paginationContainer.appendChild(pageButton);
                }

                const nextButton = document.createElement('a');
                nextButton.classList.add('page-btn');
                nextButton.textContent = 'ถัดไป';
                nextButton.href = `?page=${page + 1}`;
                if (page === totalPages) { nextButton.classList.add('disabled'); }
                paginationContainer.appendChild(nextButton);
            };

            const handleNavigation = (e) => {
                const target = e.target.closest('.page-btn');
                if (!target || target.classList.contains('active') || target.classList.contains('disabled')) {
                    e.preventDefault(); return;
                }
                e.preventDefault();
                const url = new URL(target.href);
                const page = parseInt(url.searchParams.get('page')) || 1;
                history.pushState({page: page}, '', target.href);
                displayPage(page);
            }

            paginationContainer.addEventListener('click', handleNavigation);
            window.addEventListener('popstate', (e) => {
                const urlParams = new URLSearchParams(window.location.search);
                const page = parseInt(urlParams.get('page')) || 1;
                displayPage(page);
            });

            const urlParams = new URLSearchParams(window.location.search);
            const initialPage = parseInt(urlParams.get('page')) || 1;
            displayPage(initialPage);
        }

        fetchAndDisplayDogs();
    </script>
</body>
</html>