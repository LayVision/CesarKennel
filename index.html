<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ปอมปอม บูทีค</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Main layout grid for the entire shop interface -->
    <div class="shop-layout">
        <!-- Sidebar for navigation and filtering -->
        <aside class="sidebar" id="sidebar">
            <div>
                <!-- Shop Logo -->
                <div class="sidebar-logo">PomPom<span>.</span></div>
                
                <!-- Main Navigation Menu -->
                <nav class="sidebar-nav">
                    <h3>เมนู</h3>
                    <ul>
                        <li><a href="index.html" class="active">น้องหมาทั้งหมด</a></li>
                        <li><a href="#">เพศผู้</a></li>
                        <li><a href="#">เพศเมีย</a></li>
                        <li><a href="#">เกี่ยวกับเรา</a></li>
                    </ul>
                </nav>
                
                <!-- Filtering options for products -->
                <div class="sidebar-filters">
                    <h3>ตัวกรอง</h3>
                    <!-- Filter by color -->
                    <div class="filter-group">
                        <label for="filter-color">สี</label>
                        <select id="filter-color" name="color">
                            <option>ทั้งหมด</option>
                            <option>ขาว</option>
                            <option>น้ำตาล</option>
                            <option>ดำ</option>
                        </select>
                    </div>
                    <!-- Filter by age -->
                    <div class="filter-group">
                        <label for="filter-age">อายุ</label>
                        <select id="filter-age" name="age">
                            <option>ทั้งหมด</option>
                            <option>2 เดือน</option>
                            <option>3 เดือน</option>
                            <option>4 เดือนขึ้นไป</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Sidebar footer with copyright and admin login link -->
            <div class="sidebar-footer">
                &copy; 2568 ปอมปอม บูทีค
                <p><a href="login.html" id="auth-link">เข้าสู่ระบบผู้ดูแล</a></p>
            </div>
        </aside>
        
        <!-- Main content area for displaying products -->
        <main class="main-content">
            <!-- Header for mobile view, includes logo and menu toggle -->
            <header class="mobile-header">
                <div class="mobile-logo">PomPom<span>.</span></div>
                <button class="mobile-menu-button" id="menu-toggle">☰</button>
            </header>

            <!-- Hero section with a large cover image and marquee text -->
            <section class="hero-section">
                <div class="hero-image-container">
                    <img src="https://images.pexels.com/photos/1805164/pexels-photo-1805164.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Cover Image">
                </div>
                <div class="marquee-container">
                    <p class="marquee-text">✨ น้องหมาสุขภาพดี เกรดพรีเมียม พร้อมย้ายบ้านแล้ววันนี้! ✨</p>
                </div>
            </section>

            <!-- Header for desktop view -->
            <header class="desktop-header">
                <h1>เพื่อนคู่ใจแสนน่ารัก</h1>
                <p>น้องหมาทุกตัวถูกเลี้ยงด้วยความรัก พร้อมที่จะเป็นสมาชิกใหม่ในครอบครัวคุณ</p>
            </header>

            <!-- Grid container for all product cards. This will be populated by Firebase script. -->
            <div class="product-grid" id="product-grid">
                <!-- Content will be loaded dynamically. -->
            </div>

            <!-- Container for pagination buttons, populated by script.js -->
            <div class="pagination-container" id="pagination"></div>
        </main>
    </div> <!-- End of .shop-layout -->

    <!-- Main site footer, separate from the grid layout -->
    <footer class="site-footer">
        <div class="footer-content">
            <h3 class="footer-logo">ปอมปอม บูทีค</h3>
            <p class="footer-description">ฟาร์มปอมเมอเรเนียนเกรดพรีเมียม จัดส่งทั่วประเทศ</p>
            <div class="footer-contact">
                <span>โทร: 081-234-5678</span> | <span>อีเมล: contact@pompomboutique.com</span>
            </div>
            <!-- Social media links -->
            <div class="social-links">
                <a href="#" aria-label="Facebook">FB</a>
                <a href="#" aria-label="Instagram">IG</a>
                <a href="#" aria-label="Line">LINE</a>
            </div>
        </div>
    </footer>

    <!-- Link to the main JavaScript file -->
    <script src="script.js"></script>

    <!-- Main Firebase Logic for this page -->
    <script type="module">
        import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        // --- CORRECTED IMPORT PATH BELOW ---
        import { getFirestore, collection, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // --- Firebase Initialization ---
        const firebaseConfig = {
            apiKey: "AIzaSyA85L7n2CGKocgWg-Z8TsNlUN9AVVJguBQ",
            authDomain: "cesarkennel.firebaseapp.com",
            projectId: "cesarkennel",
            storageBucket: "cesarkennel.firebasestorage.app",
            messagingSenderId: "512752480416",
            appId: "1:512752480416:web:c71aa9dc281a3932b419c5"
        };
        
        const app = !getApps().length ? initializeApp(firebaseConfig) : getApp();
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // --- Manage Admin Link ---
        const authLink = document.getElementById('auth-link');
        onAuthStateChanged(auth, user => {
            if (user) {
                authLink.textContent = 'แผงควบคุม';
                authLink.href = 'admin.html';
            } else {
                authLink.textContent = 'เข้าสู่ระบบผู้ดูแล';
                authLink.href = 'login.html';
            }
        });

        // --- Main Function to Fetch and Display Products ---
        const productGrid = document.getElementById('product-grid');
        const fetchAndDisplayProducts = async () => {
            productGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1;">กำลังโหลดน้องหมา...</p>';

            try {
                const productsRef = collection(db, "products");
                const q = query(productsRef, orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    productGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1;">ตอนนี้ยังไม่มีน้องหมาพร้อมย้ายบ้านค่ะ</p>';
                    return;
                }
                
                productGrid.innerHTML = ''; // Clear loading message
                querySnapshot.forEach(doc => {
                    const product = doc.data();
                    const productId = doc.id;
                    productGrid.innerHTML += createProductCardHTML(product, productId);
                });

                initializePagination();

            } catch (error) {
                console.error("Error fetching products:", error);
                if (error.code === 'failed-precondition') {
                     productGrid.innerHTML = `<p style="color: red; text-align: center; grid-column: 1 / -1;">
                        <b>ข้อผิดพลาด:</b> ต้องสร้าง Index ใน Firestore ก่อน โปรดเปิด Console (F12) เพื่อหาลิงก์สำหรับสร้าง Index
                     </p>`;
                } else {
                     productGrid.innerHTML = '<p style="color: red; text-align: center; grid-column: 1 / -1;">เกิดข้อผิดพลาดในการโหลดข้อมูล</p>';
                }
            }
        };

        // --- Helper Function to Create Product Card HTML (More Robust) ---
        const createProductCardHTML = (product, id) => {
            const isSold = product.status === 'sold';
            const price = product.price || 0;
            const discountPrice = product.discountPrice || 0;
            const hasDiscount = discountPrice > 0 && discountPrice < price;

            let priceHTML = `<div class="card-price">${price.toLocaleString('th-TH')} บาท</div>`;
            if (hasDiscount) {
                priceHTML = `
                    <div class="card-price">
                        <span class="original-price">${price.toLocaleString('th-TH')}</span>
                        <span class="discounted-price">${discountPrice.toLocaleString('th-TH')} บาท</span>
                    </div>`;
            }

            const statusMap = {
                available: { class: 'available', text: 'พร้อมย้ายบ้าน' },
                preordered: { class: 'preordered', text: 'ติดจอง' },
                sold: { class: 'sold', text: 'ขายแล้ว' }
            };
            const statusInfo = statusMap[product.status] || statusMap.available;

            return `
                <a href="product-detail.html?id=${id}" class="product-card ${isSold ? 'sold-item' : ''}">
                    <div class="card-image-container">
                        <span class="card-status ${statusInfo.class}">${statusInfo.text}</span>
                        <img src="${product.thumbnailUrl || 'https://via.placeholder.com/400'}" alt="${product.name || 'น้องหมา'}">
                    </div>
                    <div class="card-content">
                        <h3>${product.name || 'ไม่มีชื่อ'}</h3>
                        <div class="card-details">
                            <span>เพศ${product.gender || '-'}</span>
                            <span>${product.age || '-'}</span>
                        </div>
                        ${priceHTML}
                    </div>
                </a>`;
        };
        
        // --- PAGINATION LOGIC ---
        const initializePagination = () => {
            const paginationContainer = document.getElementById('pagination');
            if (!productGrid || !paginationContainer) return;

            const itemsPerPage = 6;
            const allItems = Array.from(productGrid.getElementsByClassName('product-card'));
            if (allItems.length <= itemsPerPage) {
                paginationContainer.innerHTML = '';
                return;
            };

            const totalPages = Math.ceil(allItems.length / itemsPerPage);

            function displayPage(page) {
                page = Math.max(1, Math.min(page, totalPages));
                const startIndex = (page - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                allItems.forEach((item, index) => {
                    item.style.display = (index >= startIndex && index < endIndex) ? 'block' : 'none';
                });
                
                updatePaginationButtons(page, totalPages);
                if (history.state?.page !== page) {
                    const url = new URL(window.location);
                    url.searchParams.set('page', page);
                    history.pushState({page: page}, '', url);
                }
            }

            function updatePaginationButtons(currentPage, totalPages) {
                paginationContainer.innerHTML = '';

                const createButton = (text, page, isDisabled = false, isActive = false) => {
                    const btn = document.createElement('a');
                    btn.classList.add('page-btn');
                    btn.textContent = text;
                    if (isDisabled) btn.classList.add('disabled');
                    if (isActive) btn.classList.add('active');
                    if (!isDisabled) {
                        btn.href = `?page=${page}`;
                        btn.addEventListener('click', e => {
                            e.preventDefault();
                            displayPage(page);
                        });
                    }
                    return btn;
                };

                paginationContainer.appendChild(createButton('ก่อนหน้า', currentPage - 1, currentPage === 1));

                for (let i = 1; i <= totalPages; i++) {
                    paginationContainer.appendChild(createButton(i, i, false, i === currentPage));
                }
                
                paginationContainer.appendChild(createButton('ถัดไป', currentPage + 1, currentPage === totalPages));
            }
            
            window.onpopstate = (e) => {
                const page = e.state?.page || 1;
                displayPage(page);
            };

            const initialUrlParams = new URLSearchParams(window.location.search);
            const initialPage = parseInt(initialUrlParams.get('page')) || 1;
            displayPage(initialPage);
        };

        // --- Run on page load ---
        fetchAndDisplayProducts();
    </script>
</body>
</html>```

### 2. `product-detail.html` (Corrected)

```html
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ข้อมูลน้องหมา - ปอมปอม บูทีค</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="shop-layout">
        <aside class="sidebar" id="sidebar">
            <div>
                <div class="sidebar-logo">PomPom<span>.</span></div>
                <nav class="sidebar-nav">
                    <h3>เมนู</h3>
                    <ul>
                        <li><a href="index.html">น้องหมาทั้งหมด</a></li>
                        <li><a href="#">เพศผู้</a></li>
                        <li><a href="#">เพศเมีย</a></li>
                        <li><a href="#">เกี่ยวกับเรา</a></li>
                    </ul>
                </nav>
            </div>
            <div class="sidebar-footer">
                &copy; 2568 ปอมปอม บูทีค
                <p><a href="login.html" id="auth-link">เข้าสู่ระบบผู้ดูแล</a></p>
            </div>
        </aside>
        
        <main class="main-content" id="main-content">
            <header class="mobile-header">
                <div class="mobile-logo">PomPom<span>.</span></div>
                <button class="mobile-menu-button" id="menu-toggle">☰</button>
            </header>

            <div class="product-detail-grid" id="product-detail-container">
                <!-- Dynamic content appears here -->
            </div>
        </main>
    </div>

    <footer class="site-footer">
        <div class="footer-content">
            <h3 class="footer-logo">ปอมปอม บูทีค</h3>
            <p class="footer-description">ฟาร์มปอมเมอเรเนียนเกรดพรีเมียม จัดส่งทั่วประเทศ</p>
            <div class="footer-contact">
                <span>โทร: 081-234-5678</span> | <span>อีเมล: contact@pompomboutique.com</span>
            </div>
            <div class="social-links">
                <a href="#" aria-label="Facebook">FB</a>
                <a href="#" aria-label="Instagram">IG</a>
                <a href="#" aria-label="Line">LINE</a>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>

    <script type="module">
        import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        // --- CORRECTED IMPORT PATH BELOW ---
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA85L7n2CGKocgWg-Z8TsNlUN9AVVJguBQ",
            authDomain: "cesarkennel.firebaseapp.com",
            projectId: "cesarkennel",
            storageBucket: "cesarkennel.firebasestorage.app",
            messagingSenderId: "512752480416",
            appId: "1:512752480416:web:c71aa9dc281a3932b419c5"
        };
        
        const app = !getApps().length ? initializeApp(firebaseConfig) : getApp();
        const db = getFirestore(app);
        const auth = getAuth(app);

        const authLink = document.getElementById('auth-link');
        onAuthStateChanged(auth, user => {
            if (user) {
                authLink.textContent = 'แผงควบคุม';
                authLink.href = 'admin.html';
            } else {
                authLink.textContent = 'เข้าสู่ระบบผู้ดูแล';
                authLink.href = 'login.html';
            }
        });
        
        const container = document.getElementById('product-detail-container');
        const fetchProductDetails = async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');

            if (!productId) {
                container.innerHTML = '<h1>ไม่พบรหัสสินค้า</h1><p>โปรดกลับไปที่<a href="index.html">หน้าร้าน</a></p>';
                return;
            }

            container.innerHTML = '<p style="text-align: center;">กำลังโหลดข้อมูล...</p>';

            try {
                const docRef = doc(db, 'products', productId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const product = docSnap.data();
                    displayProductDetails(product);
                } else {
                    container.innerHTML = '<h1>404 - ไม่พบข้อมูล</h1><p>เราไม่พบน้องหมาที่คุณค้นหา <a href="index.html">กลับสู่หน้าร้าน</a></p>';
                    document.title = "ไม่พบข้อมูล - ปอมปอม บูทีค";
                }
            } catch (error) {
                console.error("Error fetching product details:", error);
                container.innerHTML = '<p style="color: red; text-align: center;">เกิดข้อผิดพลาดในการโหลดข้อมูล</p>';
            }
        };

        const displayProductDetails = (product) => {
            document.title = `${product.name} - ปอมปอม บูทีค`;
            
            let buttonHTML = `<button class="add-to-cart-button">ติดต่อเพื่อจอง</button>`;
            if (product.status === 'sold') {
                buttonHTML = `<button class="add-to-cart-button sold-button" disabled>รายการนี้ขายแล้ว</button>`;
            }
            
            const price = product.price || 0;
            const discountPrice = product.discountPrice || 0;
            const hasDiscount = discountPrice > 0 && discountPrice < price;
            let priceHTML = `<span class="discounted-price">${price.toLocaleString('th-TH')} บาท</span>`;
            if (hasDiscount) {
                priceHTML = `
                    <span class="original-price">${price.toLocaleString('th-TH')}</span>
                    <span class="discounted-price">${discountPrice.toLocaleString('th-TH')} บาท</span>
                `;
            }

            let thumbnailsHTML = '';
            const imageUrls = product.imageUrls || [];
            if (imageUrls.length > 0) {
                imageUrls.forEach((url, index) => {
                    const thumbUrl = url.includes('?') ? `${url}&w=400` : `${url}?w=400`;
                    thumbnailsHTML += `<img src="${thumbUrl}" alt="รูปย่อ ${index + 1}" class="${index === 0 ? 'active' : ''}">`;
                });
            }
            const mainImageUrl = imageUrls.length > 0 ? imageUrls[0].replace('&w=400', '&w=800') : 'https://via.placeholder.com/800';

            container.innerHTML = `
                <div class="detail-gallery">
                    <img src="${mainImageUrl}" alt="รูปหลักของ ${product.name}" id="mainImage" class="main-image">
                    <div class="detail-thumbnails" id="thumbnail-container">
                        ${thumbnailsHTML}
                    </div>
                </div>
                <div class="detail-info">
                    <h1>${product.name || 'ไม่มีชื่อ'}</h1>
                    <div class="price">${priceHTML}</div>
                    <p class="description">${product.description || 'ไม่มีคำอธิบายเพิ่มเติม'}</p>
                    <ul class="details-list">
                        <li><strong>สายพันธุ์:</strong><span>${product.breed || '-'}</span></li>
                        <li><strong>อายุ:</strong><span>${product.age || '-'}</span></li>
                        <li><strong>เพศ:</strong><span>${product.gender || '-'}</span></li>
                        <li><strong>ตัวสี:</strong><span>${product.color || '-'}</span></li>
                        <li><strong>ตาสี:</strong><span>${product.eyeColor || '-'}</span></li>
                        <li><strong>วัคซีน:</strong><span>${product.vaccine || '-'}</span></li>
                    </ul>
                    ${buttonHTML}
                </div>
            `;
            
            initializeGalleryListeners();
        };
        
        const initializeGalleryListeners = () => {
            const mainImage = document.getElementById('mainImage');
            const thumbnails = document.querySelectorAll('#thumbnail-container img');
            
            if (mainImage && thumbnails.length) {
                thumbnails.forEach(thumb => {
                    thumb.addEventListener('click', function() {
                        const highResSrc = this.src.replace('&w=400', '&w=800');
                        mainImage.src = highResSrc;
                        mainImage.alt = this.alt.replace('รูปย่อ', 'รูปหลักของ');
                        thumbnails.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
            }
        }

        fetchProductDetails();
    </script>
</body>
</html>